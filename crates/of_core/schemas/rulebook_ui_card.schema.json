{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://of_core.local/schemas/rulebook_ui_card.schema.json",
  "title": "RuleBook UI Explain Card (Why Button)",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "lang", "event", "cards", "raw_payload"],
  "properties": {
    "schema_version": { "type": "string", "const": "1.0" },
    "lang": { "type": "string", "enum": ["ko", "en"] },
    "event": {
      "type": "object",
      "additionalProperties": false,
      "required": ["event_type", "timestamp_ms", "minute", "team_side"],
      "properties": {
        "event_type": { "type": "string" },
        "timestamp_ms": { "type": "integer", "minimum": 0 },
        "minute": { "type": "integer", "minimum": 0 },
        "team_side": { "type": "string", "enum": ["home", "away", "unknown"] }
      }
    },
    "rule": {
      "description": "Optional. Some events (e.g., VAR review) may not map to a RuleId/law reference.",
      "type": ["object", "null"],
      "additionalProperties": false,
      "required": ["rule_id", "law_number", "law_name"],
      "properties": {
        "rule_id": { "type": "string" },
        "law_number": { "type": "integer", "minimum": 1, "maximum": 17 },
        "law_name": { "type": "string" },
        "law_name_en": { "type": "string" }
      }
    },
    "cards": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/CardBlock" }
    },
    "raw_payload": {
      "description": "Engine payload snapshot (lossless). UI must render cards from `cards`, not from raw_payload.",
      "type": "object"
    }
  },
  "$defs": {
    "CardBlock": {
      "type": "object",
      "additionalProperties": false,
      "required": ["level", "title", "lines"],
      "properties": {
        "level": { "type": "integer", "enum": [1, 2, 3] },
        "title": { "type": "string" },
        "lines": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/CardLine" }
        }
      }
    },
    "CardLine": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "text"],
      "properties": {
        "kind": { "type": "string", "enum": ["plain", "bullet", "kv", "warning", "note"] },
        "text": { "type": "string" },
        "key": { "type": "string" },
        "value": { "type": ["string", "number", "boolean", "null", "object", "array"] },
        "ref": {
          "description": "Optional deep link for replay/analytics to highlight something.",
          "type": "object",
          "additionalProperties": false,
          "required": ["type", "id"],
          "properties": {
            "type": { "type": "string", "enum": ["player_track_id", "pitch_x_m", "pitch_line", "event_id"] },
            "id": { "type": "string" }
          }
        }
      },
      "allOf": [
        {
          "if": { "properties": { "kind": { "const": "kv" } } },
          "then": { "required": ["key", "value"] }
        }
      ]
    }
  }
}
